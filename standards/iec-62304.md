# IEC 62304

* Software can contribute to a hazardous situation
* Software can be used to control risk

* Software must be developed under a quality management system, and a risk management system
* Maintenance is as important as development

* Three major principles to promote safety in health software
  * Risk management
    * See ISO 14971, ISO 31000
  * Quality management
    * Disciplined and effective set of defined processes
    * See ISO 9001, ISO 13485, ISO
  * Software engineering

* In scope
  * Software risk management
  * Software configuration management
  * Software problem resolution
* Not in scope
  * System requirements process
  * Validation of software
  * Releasing software
  * Names, format and content of documentation
  

  
## Lingo
### Process
* Documentation is evidence of a controlled process
  * Process is a set of activities, activities are a set of tasks
  * Input to a process is typically the output of another
  * Waterfall model somewhat implied but is not prescribed
  * Outputs must be maintained in a consistent state, downstream processes must be updated promptly if an output has changed
  * All outputs and dependencies should be determined to be consistent before release
### Software
* Software composed of a system, items and units
  * A software unit is a software item that cannot be further divided
  * A software item is "any identifiable part of a computer program"
  * The granularity of this is up to the manufacturer
* SOUP
  * Software of unknown provenance
* Maintenance
  * modification of software after release for intended use
  * includes processes to act on problem reports
  * Categorised as:
    * corrective (fixes)
    * adaptive (new hardware, OS etc)
    * perfective (new requirements)
    * preventative (make maintenance easier)
* Release
  * a version of a configuration item, made available for a specific purpose
  * a configuration item is an entity that can be uniquely identified at a point in time  

## Versioning
* Any new version requires a software configuration management process





## Software development plan
* May explicitly define or make reference to the chosen software development life cycle model
* No model is implied, tasks can; overlap, iteract, be performed iteratively or recursively
  * See ISO 12207 for example models (waterfall, incremental, evolutionary)
  * A software item could be spec'd, implemented and verified before the overall architecture has been finalised
* Must address:
  * Processes
    * Can identify different activities for tasks based on classification
    * Standards, methods and tools associated with development (C)
    * Integration testing (B,C)
  * Deliverables
    * What artifacts and documentation are produced by activities and tasks
    * What deliverables require verification, what is the acceptance criteria
  * Traceability 
  * Configuration and change management
    * SOUP configuration items
    * Software to support development
    * When should change control be used, and what is the process
      * Includes compiler versions, Make files, environment settings
  * Problem resolution
    * Activities and deliverables for handling problems
  * Risk management
  * Documentation planning
    * Title, names, purpose
    * Procedures for development, review, approval and modification


## Software requirements analysis
* functional requirements, constraints
* inputs and outputs
* interfaces
* warnings and operator messages
* security capabilities, auditing
* UI requirements
* forms, data and databases
* installation and acceptance
* operation and maintenance
* networking
* user maintenance
* regulatory requirements


## SOUP

* SOUP should be identified (8.1.2)
  * Title, manufacturer, "soup designator" (version, release date, etc.)
* SOUP configuration items shall be detailed in the software development plan (5.1.1d)
* Plan to integrate SOUP (5.1.5)
* Plan to manage the risk of SOUP (5.1.7)
* Specify functional and performance requirements of SOUP (B,C) to document its intended use (5.3.3)
* Specify hardware and software required by SOUP (B,C) to document proper operation (5.3.4)
* Architecture must be verified to ensure proper operation of SOUP (5.3.6)
* Document procedure to evaluate and implement changes to SOUP due to updates, patches, obsolescence (6.1f)
* Failure of unexpected results from SOUP must be identified during risk planning (7.1.2)
* Evidence of evaluation of a published anomaly list for a SOUP configuration item, if there is a risk that failure or unexpected results may lead to a hazardous situation (7.1.3)
* Software change process should consider whether changes will require additional risk control measures or impact existing risk control measures (7.4.1, 7.4.2) 

## Security
* General security covered by ISO 27799
* This standard covers security in the context of safety, namely;
  * Lack of availability
  * Lack of integrity
  * Loss of confidentiality

## Usability
* No processes defined by this standard, but must consider usability in the context of safety, eg;
  * Misleading information
  * Incorrect usage in time-critical situations
  * Incorrect data entry

## Risk
* Gather information pertinent to risk (see ISO 14971)
* Assume the probability of an adverse software event is 1 when considering risk (harm x probability)
* Consider the probability of a hazard (p1=1) and the probability of a hazard causing harm (p2)
* See also IEC TR 80002

## Software safety classification
* Determines the rigour of development process required, determined during preliminary risk analysis
* Four steps:
  * Can this contribute to a hazardous situation (considering potential hazards, requirements and intended use)
  * External risk control measures
  * Is there unacceptable residual risk (ie. what is p2)
  * Severity of harm
* Classes
  * C (serious harm and death)
  * B (non serious harm)
  * A (cannot contribute to a hazardous situation, or cannot lead to unacceptable risk with external risk control)
* All software is Class C until proven otherwise
  * Essentially depends on the value of p2, and the severity of harm itself
* Assigned to a software system as a whole
  * A manufacturer may document a rationale for software items and units to have a different classification from the system
  * The highest classification will effectively bubble to the system level unless a risk management process defines a rationale for not doing so
* Safety classification must be under change control
  * Change to system spec of architecture, unforeseen hazards or infeasible risk controls may invalidate a classification

## Legacy software
* May be required for manufacturer to demonstrate compliance for legacy software
* Comprehensive assessment of field data should be collected for legacy software, specifically pertaining to adverse events and anomalies

## Software development process
* Ensure software can meet its intended use, reduce risks
* Can document tasks in a single or multiple plans
* Plans can reference existing company policies and procedures in whole or in part
* The plan can be developed iteratively
* The plan should be updated to reflect current knowledge of the system
* Output of design processes must be verified by the manufacturer
  * Especially important to verify design elements that relate to safety, e.g.:
    * Errors, exceptions, recovery
    * Default state, memory management
    * How faults that can lead to hazardous sitations are addressed
    * Cold and warm resets
    * Anything that can affect a risk control measure

### Requirements analysis
* System requirements is out of scope of this standard but the software requirements analysis process involves deciding how the software will meet the system design
* Manufacturer must establish and verify the software requirements
* If the risk management process imposed requirements on the software to control risk, it must be possible to trace the risk control measures to the software requirements
* It should be possible to trace requirements to system testing
* Regulatory conformance is a software requirement
* Some lingo:
  * Design inputs are the interpretation of customer needs into formal top-level system requirements
  * Software requirements are the formal documented specifications of what the software does to meet the customer need (and design inputs)
  * Functional specification are more concrete specifications (ie. alternative examples may exist that also meet the requirements) that describe how the software will do to meet these requirements
  * Software design specifications describe how the software will be decomposed to implement the system requirements and functional specifications
* May be written as a set of one or more documents but there is no prescription on presentation or storage
  * Could be implemented as a "common database" which would aid the requirement of traceability
* Security is a requirement
  * IEC 80001-2-2 lists 19 security related capabilities that should be considered
  * See also ISO 27002 and ISO 27799
* There should be a process for "negotiating changes and clarifications" to the system or software requirements, and reacting to change in the parent system or software

### Software architectural design
* Manufacturer must define "major structural components"
  * Key responsibilities
  * Externally visible properties
  * Relationships between components
* Especially important to document behaviour that can affect components of the system outside the software
* Should include "credible strategies" for ensuring separating components such that they cannot interact in an unsafe way
  * Safety classification of software items decided during this activity
  * Classification may influence architecture (eg. segregate Class A software items to their own component)
* Must define how all software items will be implemented to meet the software requirements
* Verified by technical evaluation

### Software detailed design
* Manufacturer must refine the software items from the architecture design process into software units
  * Unit could be a function or module (but is not defined as such)
  * Should be capable of being tested in isolation
* Specifies algorithms, data structures, interfaces
* Specifies packaging of the software product
* Verification of safety and effectiveness of the implementation against the design must be possible
* Should be complete enough such that a programmer does not need to make implementation decisions
* Verified by technical evaluation

### Software unit implementation
* Evidence of a coding style (may include language usage rules and restrictions, complexitity)
* The code must be verified

### Software integration and testing
* Evidence of planning the execution of software units and their aggregation into software items
* Evidence of verifying the resulting software items behave as designed
* The rigor of testing and documentation is related to the risk of the software leading to a hazardous situation
* Integration may be incremental
* White box (faults of commission) and black box tests (faults of omission) must be documented
* Test plans can be tied to development phases, or prototypes
* As usual, must be verified by the manufacturer!

### Software system testing
* Manufacturer must verify that the functionality to meet the requirements exists and has been successfully implemented
* Manufacturer responsible for ensuring the software functions for its intended use, regardless of how, when and who does the testing
* Coverage of requirements, risk control and usability should be demonstrated and documented
* Regression testing must be used for any change in the system
* Anomalies that are detected and not fixed must be documented as part of an evaluation for risk and can only remain if they do not affect safety

### Software release
* The software must be assigned a version and specify how the release was created
* Must have and follow documented release procedure
* Should be able to show that the defined software development processes were followed
* The version and associated tools should be stored for later retrieval
* Should be packaged to prevent damage and misuse

## Software maintenance process
### Software maintenance plan
* Can be a smaller process to allow for rapid change in response to defects
* Create and identify procedures for:
  * Implement corrective actions
  * Controlling change
  * Manage revised releases
* Goal is to modify released software without compromising its integrity

### Problem and modification analysis
* An analysis is necessary to determine whether a modification will affect safety or existing risk control measures
* There is a difference between software maintenance and software problem resolution
* Software maintenance covers:
  * Handling of safety related problem reports
  * Software is re-validated and re-released after modification with formal controls
  * Regression and other testing to ensure no negative effects can be impacted on the rest of the system
* Software problem resolution covers:
  * identifying the veracity and implications of a problem report
  * decides on changes and identifies side effects
  * implement changes while maintaining the consistency of software configuration items
  * verifies the change

### Modification implementation
* Can use development process tasks to make modifications, or specify a process specific for modification
* Should ensure a modification does not cause negative effects on the rest of the system (regression analysis)
* A documented rationale for the level of regression testing should be made

## Software risk management process
* Not in scope
* Note you are required to adopt a risk management process compliant with ISO 14971
* This standard specifies additional requirements for:
  * Software contributing to hazardous situations
  * Software used to control risk

## Software configuration management process
* Process of admin and technical tasks for identifying software items and documentation, controlling change and coordinating release
* "Configuration identification": Configuration items and their versions must be uniquely identifiable
* Change requests should be identifiable
* This process should avoid unauthorised or unintended changes
* This process should ensure changes only change what was approved and verify the result
* Changes can be approved by a change control board or technical lead/manager
  * Can be documented by any means eg: change control board minutes, a signature or a database
* Change requests should be traceable to the modification, verification and approval
* "Configuation status accounting": a historical record of configuration items
  * Must be possible to determine when and why changes were made, and that only authorised changes were made

### Configuration status accounting


## Software problem resolution process (defect tracking)
* Process for analysing and resolving any problem in the software, including non-comformance
* Process is "activated" regardless of the phase the software is in
* Timely, responsible, documented means to show that problems were analysed and resolved
* Overlaps with the software configuration management process as change requests are required for corrective action
* May be required to track trends in problem reports for auditing (9.6)
* Must show that problems were evaluated for effects on safety (ISO 14971)
* See also ISO 12207

### Suggested lifecycle

* Prepare problem report
* Document investigation and evaluation for risk
* Prepare change request for corrective action (or document why no action is required)
* Approve and implement the request (changing only what was required)
* Verify changes
